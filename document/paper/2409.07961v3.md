# Estimating Atmospheric Variables from Digital Typhoon Satellite Images via Conditional Denoising Diffusion Models

## 条件付きノイズ除去拡散モデルによるデジタル台風衛星画像からの大気変数推定

**著者:**

- Zhangyue Ling (Imperial College London, Department of Computing)
- Pritthijit Nath (University of Cambridge, Department of Applied Math and Theoretical Physics)
- César Quilodrán-Casas (Imperial College London, Department of Earth Science and Engineering; Grantham Institute for Climate Change and the Environment; National Center for Artificial Intelligence CENIA, Chile)

**出典:** Published as a workshop paper at "Tackling Climate Change with Machine Learning", NeurIPS 2024
**arXiv:** 2409.07961v3 [cs.CV] 17 Oct 2024
**コード:** https://github.com/TammyLing/Typhoon-forecasting

---

## 概要（Abstract）

本研究は、Digital Typhoon 衛星画像から複数の ERA5 気象変数を同時に予測するための、台風分野における拡散モデルの応用を探求しています。本研究の焦点は、台風に非常に脆弱な地域である台湾に置かれています。

条件付きノイズ除去拡散確率モデル（CDDPM）のパフォーマンスを、畳み込みニューラルネットワーク（CNN）および Squeeze-and-Excitation ネットワーク（SENet）と比較した結果、CDDPM が正確で現実的な気象データの生成において最高のパフォーマンスを発揮することが示されました。

### 主な成果

- **PSNR**: CDDPM は 32.807 を達成し、CNN より約 7.9%、SENet より 5.5%高い
- **RMSE**: CDDPM は 0.032 を記録し、CNN より 11.1%、SENet より 8.6%の改善

本研究の主要な応用は、欠損している気象データセットの補完目的と、衛星画像を使用した追加の高品質気象データの生成です。この分析の結果が、より堅牢で詳細な予測を可能にし、脆弱な地域に対する深刻な気象イベントの影響を軽減することが期待されています。

---

## 1. 序論（Introduction）

近年、地球規模の気候変動の影響により、極端な気象イベントの頻度と強度が増加しています。特に、熱帯低気圧（TC）の一種である台風は、自然環境と人間社会の両方に与える被害のために注目されています。

台湾は、アジアの主要な経済拠点であり人口密集地域の 1 つであり、台風に対する脆弱性が高いため[1]、本プロジェクトの優れた焦点地域となっています。

### 機械学習による台風予測

機械学習の急速な発展により、台風予測は多数の方法で行うことができるようになりました：

- **Rita et al. [2]**: 衛星画像データを分析するために人工ニューラルネットワークの使用を開拓し、台風軌道予測における深層学習技術の最初の応用となりました

- **Rüttgers et al. [3]**: 衛星画像と敵対的生成ネットワーク（GAN）を利用して、台風の中心座標と台風周辺の雲構造の将来の形状の両方を予測することに初めて成功しました

- **拡散モデル**: 熱帯低気圧の予測に使用されています[4]

- **DYffusion [5]**: 時間条件付き補間器と予測ネットワークを導入して、マルチステップ確率予測を行う改良された拡散モデルの 1 つです

### 本研究の貢献

これらの進歩を基に、本プロジェクトは条件付きノイズ除去拡散確率モデル（CDDPM）[6]を使用して、Digital Typhoon（DT）[7]画像を条件入力として使用し、複数の ERA5 再解析変数を同時に予測します。CDDPM は、以前にリモートセンシングで成功裏に使用されています[8-11]。

本研究の現在の文献への貢献は、以下のように要約できます：

1. **カスタマイズされた台風データセット**: 任意の地域に対して DT と ERA5 再解析データのマッチングを促進するカスタマイズされた台風データセットを作成し、将来の研究のためにさまざまな地域でより正確な予測モデルを可能にします

2. **CDDPM の優位性の実証**: 複数の再解析変数にわたって他の 3 つのモデルを一貫して上回る CDDPM の能力を実証し、最高の PSNR と SSIM スコア、最低の FID と LPIPS スコアを達成

3. **高品質データ生成**: 衛星画像から追加の高品質再解析データを生成する能力を実証し、予測と既存の再解析データセットのギャップを埋めるために使用できます

---

## 2. データ（Data）

### 2.1 データセット

#### ERA5

ERA5[12]は、1940 年以降の地球規模の気候に関する第 5 世代 ECMWF 再解析で、欧州中期気象予報センター（ECMWF）によって提供されています。

本プロジェクトでは、このデータセットがモデル入力データとして使用され、使用される変数は以下の通りです：

- **u10**: 風の u 成分（10m）
- **v10**: 風の v 成分（10m）
- **sp**: 地表気圧
- **t2m**: 2 メートルの気温

緯度と経度の範囲は、それぞれ 116.0794-126.0794 と 18.9037-28.90374 で、台湾周辺（±5°）の地域をカバーしています。

#### Digital Typhoon Dataset

Digital Typhoon Dataset[7]は、1978 年から 2022 年までの西北太平洋地域をカバーする最大の台風衛星画像データセットで、5 km の高解像度と 1 時間の時間解像度を持っています。本プロジェクトは台湾周辺の地域に焦点を当てているため、元のコレクションからフィルタリングされた 129 の台風がターゲットデータセットとして使用されます。

### 2.2 データ処理

#### 1. 地域選択とデータ抽出

- 台湾地域を 18.9037°N から 28.9037°N、116.0794°E から 126.0794°E まで選択
- 関連する台風データを抽出し、関心領域が固定されたままになるようにトリミング

#### 2. データクリーニング、整列、正規化

- エラーと不整合を除去してデータセットをクリーニング
- Digital Typhoon と ERA5 データを同期して、モデルトレーニングと推論で一貫した使用を確保
- 各変数を[0, 1]の範囲に正規化することで標準化し、すべての入力特徴にわたって一貫したスケーリングを確保

#### 3. データ拡張とトレーニング・テスト分割

- ランダムノイズ追加、ガウススムージング、コントラスト調整などの拡張技術を適用して、モデルの汎化能力を向上
- データセットを 80%のトレーニング用と 20%のテスト用に分割し、トレーニングデータに拡張を適用

---

## 3. 方法論（Methodology）

### 3.1 トレーニング

**順方向拡散プロセス**

順方向拡散プロセスは、入力 ERA5 変数（u10、v10、sp、t2m）に T 個の時間ステップにわたってガウスノイズを段階的に追加することにより、ERA5 気象データを純粋なノイズに徐々に変換することを含みます。各ステップでは、少量のノイズと混合することでデータをわずかに劣化させ、最終的にほぼ均一なノイズ分布になります。このノイズの多いデータは、プロセスを逆転させるためにモデルをトレーニングする基礎として機能します。

**逆方向拡散プロセス**

逆方向拡散プロセスは、順方向プロセス中に生成されたノイズの多い観測から元のクリーンな再解析データ（ERA5）を再構築することを目的としています。CDDPM のコンテキストでは、逆プロセスはニューラルネットワーク p_θ によってパラメータ化されます。

ネットワークは以下を入力として受け取ります：

- **条件データ x**: Digital Typhoon データ
- **ノイズの多い観測 y**: ノイズの多い ERA5
- **ノイズレベル γ**

そして、ノイズ成分 ε を予測します。目標は、予測されたノイズと真のノイズの差を最小化することであり、それによって拡散プロセスを効果的に逆転させることを学習します。

**図 1: CDDPM ワークフロー**

- y_0 は ERA5 を表し、x は DT 衛星画像を表します
- 順方向拡散では、y_0 にノイズが反復的に追加されます
- 逆方向拡散では、モデルは y_T から y_0 に向かってデノイズし、x を条件とします

### 3.2 推論

推論中、訓練されたモデルは DT データ x を条件として使用して、正規分布からサンプリングされたノイズの多いデータ y_T を反復的に精製し、徐々にデノイズしてクリーンな ERA5 気象データを生成します。

**推論プロセスの要約**：

1. **ノイズで初期化**: 純粋なガウスノイズ y_T のサンプルから開始し、これが初期のノイズの多い入力として機能

2. **反復デノイズ**: 各時間ステップ t について、T から 1 まで：

   - モデルを使用して、現在のノイズの多いデータ y*t と条件入力 x からデノイズされたデータ y*{t-1}を予測
   - t > 1 の場合、ノイズ z ~ N(0, I)をサンプリング。そうでない場合、z = 0 を設定
   - 予測された平均と分散を使用して次のステップ y\_{t-1}を計算

3. **最終予測**: 最終出力 y_0 は、DT データを条件として、ノイズの多い入力から再構築されたクリーンな ERA5 気象データ

---

## 4. 結果（Results）

### 4.1 風速の大きさの予測

風速の大きさ M（m/s）は、全体的な風速と方向を理解するための重要な指標であり、2 つの風成分 u10 と v10 のユークリッドノルムとして計算されます：

M = √(u10² + v10²)

台風 Muifa は、2022 年 9 月に西北太平洋地域に影響を与えた重要な台風でした。図 2 は、このイベントの衛星画像に対するモデルの予測を示しています。明らかに、CDDPM はグラウンドトゥルースに最も近い予測を提示しています。

**図 2: 2022 年 9 月 9 日の台風 Muifa の予測例**

- 予測された u10 と v10 成分から導出された予測風速の大きさを示しています

### 4.2 パフォーマンスメトリクス

すべての変数にわたる全体的なパフォーマンスを考慮すると、CDDPM が最も信頼性が高く効果的なモデルとして浮上します。

**表 1: テストデータセット全体の平均評価結果**（太字は最高のパフォーマンスを示す）

| モデル    | 変数 | KL-Div↓ | RMSE↓     | MAE↓      | PSNR↑      | SSIM↑     | FID↓      | LPIPS↓     |
| --------- | ---- | ------- | --------- | --------- | ---------- | --------- | --------- | ---------- |
| CNN       | u10  | 0.003   | 0.039     | 0.029     | 29.441     | 0.886     | 0.068     | 146.522    |
|           | v10  | 0.004   | 0.043     | 0.032     | 28.955     | 0.872     | 0.064     | 135.013    |
|           | t2m  | 0.000   | 0.024     | 0.021     | 33.529     | 0.991     | 0.004     | 27.874     |
|           | sp   | 0.003   | 0.039     | 0.029     | 29.741     | 0.913     | 0.024     | 149.301    |
|           | 平均 | 0.003   | 0.036     | 0.028     | 30.417     | 0.916     | 0.040     | 114.678    |
| SENet     | u10  | 0.004   | 0.041     | 0.031     | 28.594     | 0.883     | 0.069     | 170.500    |
|           | v10  | 0.004   | 0.044     | 0.034     | 28.305     | 0.869     | 0.063     | 148.516    |
|           | t2m  | 0.000   | 0.014     | 0.012     | 38.101     | 0.991     | 0.004     | 41.946     |
|           | sp   | 0.003   | 0.041     | 0.029     | 29.404     | 0.916     | 0.025     | 135.948    |
|           | 平均 | 0.003   | 0.035     | 0.026     | 31.101     | 0.915     | 0.040     | 124.227    |
| **CDDPM** | u10  | 0.004   | 0.037     | 0.027     | **30.973** | **0.900** | **0.052** | **85.518** |
|           | v10  | 0.004   | 0.041     | 0.031     | **30.199** | **0.891** | **0.051** | **91.219** |
|           | t2m  | 0.000   | 0.013     | 0.011     | **39.751** | **0.995** | **0.003** | **12.820** |
|           | sp   | 0.003   | 0.039     | 0.028     | **30.305** | **0.929** | **0.024** | **76.502** |
|           | 平均 | 0.003   | **0.032** | **0.024** | **32.807** | **0.929** | **0.032** | **66.514** |

### 主な発見

CDDPM は、最も高い PSNR と SSIM 値を一貫して達成し、最も低い KL-Div、RMSE、FID、LPIPS を記録し、正確で現実的な予測を必要とするアプリケーションのトップチョイスとなっています。SENet と CNN も良好に機能し、強力な候補です。

---

## 5. 結論（Conclusion）

本研究は、CNN、SENet、CDDPM を含むさまざまな機械学習モデルの有効性を評価しています。これらは、台湾周辺地域に焦点を当てて、衛星画像を使用して複数の気象変数を同時に予測します。

### 主な成果

パフォーマンスメトリクスと風速の大きさの予測を評価した結果、CDDPM が気象予測において最も信頼性が高いことが証明されました。

### 今後の研究

今後の研究には以下が含まれます：

1. **地理的範囲の拡大**: 異なる地理的地域と気象現象でモデルをテストして、汎化性と堅牢性を検証

2. **時間動態の組み込み**: 時系列データを使用することで、特に台風のような急速に変化するシステムにおいて、気象変数がどのように進化するかの予測を改善

3. **マルチモーダルモデルの探求**: レーダーなどの多様なデータタイプを統合することで、予測の堅牢性と精度を向上

---

## 謝辞と資金開示（Acknowledgements）

- P. Nath は、UKRI Centre for Doctoral Training in Application of Artificial Intelligence to the study of Environmental Risks [EP/S022961/1]によってサポートされました

- C. Quilodrán-Casas は National Center for Artificial Intelligence CENIA FB210017、Basal ANID および UKRI-IAA Purify (PSP411)によってサポートされました

---

## 参考文献（References）

[1] Xu X, Sun D, Guo T. A systemic analysis of typhoon risk across China. Natural Hazards, 2015.
[2] Kovordányi R, Roy C. Cyclone track forecasting based on satellite images using artificial neural networks. ISPRS Journal, 2009.
[3] Rüttgers M, et al. Prediction of a typhoon track using a generative adversarial network and satellite images. Scientific reports, 2019.
[4] Nath P, et al. Forecasting Tropical Cyclones with Cascaded Diffusion Models. arXiv, 2023.
[5] Cachay SR, et al. Dyffusion: A dynamics-informed diffusion model for spatiotemporal forecasting. arXiv, 2023.
[6] Saharia C, et al. Palette: Image-to-image diffusion models. ACM SIGGRAPH, 2022.
[7] Kitamoto A, et al. Digital typhoon: Long-term satellite image dataset for the spatio-temporal modeling of tropical cyclones. NeurIPS, 2024.
[8] Zhang W, et al. Inpainting Radar Missing Data via Denoising Iterative Restoration. IEEE Journal, 2024.
[9] Qosja D, et al. SAR Image Synthesis with Diffusion Models. IEEE Radar Conference, 2024.
[10] Haitsiukevich K, et al. Diffusion models as probabilistic neural operators. arXiv, 2024.
[11] Guan M, et al. DiffWater: Underwater image enhancement. IEEE Journal, 2023.
[12] Hersbach H, et al. The ERA5 global reanalysis. Quarterly Journal of the Royal Meteorological Society, 2020.

---

## 付録 A: 他のモデルの方法論

### A.1 CNN

**図 A.1: 条件付き畳み込みニューラルネットワークの構造**

提案された CNN アーキテクチャは、Digital Typhoon データセットからの単一チャンネル衛星画像を処理し、それを 4 チャンネル入力に複製します。これにより、画像はトレーニングで使用される 4 つの ERA5 気象変数と整列します：

- u10（東西風）
- v10（南北風）
- sp（地表気圧）
- t2m（2 メートル気温）

複製された 4 チャンネル入力画像は、4 つの残差ブロックを通じて処理されます。各ブロックは、空間次元を保持しながら入力特徴マップを変換します。残差ブロックの後、特徴マップは 4 つの画像アップサンプル層を通過し、各層は出力が元の入力サイズと一致するまで空間次元を増加させます。

### A.2 SENet

このプロジェクトは、それぞれが異なる気象変数を表す 4 つのチャンネルを持つマルチタスクシナリオを含むため、チャンネル間の相互依存性を効果的にモデル化する能力により、SENet が選択されました。SENet アーキテクチャは、各残差ブロック内に Squeeze-and-Excitation（SE）ブロックを統合することにより、ベースライン CNN の上に構築されています。これにより、ネットワークはより複雑なチャンネル間の依存関係を捉え、全体的な特徴表現を改善できます。

---

## 付録 B: 追加結果

### B.1 視覚的結果

図 B.2 は、CNN、SENet、DDPM、CDDPM の 4 つの異なるモデルの結果例を示しています。4 つの変数の予測気象データが比較されました：

- u 成分風（u10）
- v 成分風（v10）
- 地表気圧（sp）
- 2 メートルの気温（t2m）

### B.2 ピクセル差

ピクセル差メトリクスは、生成された気象データにおける予測ピクセル値と実際のピクセル値の不一致を定量化します。

**表 B.1: 異なるモデルと変数のミスマッチ値**

| モデル | u10      | v10      | t2m     | sp      | 平均    |
| ------ | -------- | -------- | ------- | ------- | ------- |
| CNN    | 149.539  | 222.422  | 4.865   | 197.252 | 143.520 |
| SENet  | 151.089  | 234.270  | 0.887   | 214.000 | 150.061 |
| DDPM   | 1128.631 | 1829.025 | 219.908 | 568.504 | 936.517 |
| CDDPM  | 181.326  | 225.301  | 1.684   | 205.004 | 153.329 |

上記の表 B.1 に基づくと、CNN は全体的に最も低いミスマッチを持ち、SENet と CDDPM も良好に機能します。ただし、CDDPM はパフォーマンスメトリクスで優れていますが、ピクセル差が高くなっています。これは、小さいながらも多数の局所的エラーのためである可能性があり、全体的なピクセル差が高くなります。

これらの不一致は、モデルの損失関数が逆拡散プロセス中のノイズを最小化することを優先するために発生する可能性があります。このプロセスの主な目標は、正確なピクセル単位の再構築に焦点を当てるのではなく、元のデータの全体的な構造と分布を正確に回復することです。

---

## まとめ

本論文は、条件付きノイズ除去拡散モデル（CDDPM）を使用して、衛星画像から気象変数を推定する新しいアプローチを提示しています。主な利点は以下の通りです：

1. **高い予測精度**: CDDPM は複数のメトリクスで他のモデルを上回る
2. **実用的応用**: 欠損データの補完と高品質データ生成
3. **地域特化**: 台湾周辺の台風予測に焦点
4. **汎用性**: 他の地域や気象現象への拡張可能性

この研究は、拡散モデルが気象予測、特に台風予測において効果的なツールとなり得ることを示しています。
