# Pangu-Weather: 3 次元ニューラルネットワークによる正確な中期的グローバル気象予測

## 論文情報

- **タイトル**: Accurate medium-range global weather forecasting with 3D neural networks
- **著者**: Kaifeng Bi, Lingxi Xie, Hengheng Zhang, Xin Chen, Xiaotao Gu, Qi Tian (Huawei Cloud)
- **掲載誌**: Nature, Vol 619, pp.533-538 (2023 年 7 月 20 日)
- **DOI**: https://doi.org/10.1038/s41586-023-06185-3

## 概要

本論文は、人工知能（AI）ベースの気象予測システム「Pangu-Weather（盤古気象）」を紹介している。Pangu-Weather は、現在世界最高精度とされる数値気象予測（NWP）システムである ECMWF（ヨーロッパ中期予報センター）の operational IFS を、再解析データに対する決定論的予測において全テスト変数で上回る性能を示した。

### 主要な成果

- **精度**: ERA5 再解析データに対して、全テスト変数で operational IFS と FourCastNet を上回る精度を達成
- **速度**: operational IFS より 10,000 倍以上高速（単一 GPU で 1.4 秒）
- **予測時間利得**: operational IFS に対して 10-15 時間、FourCastNet に対して最大 40 時間の予測時間利得
- **5 日間 Z500 予測の RMSE**: 296.7（operational IFS: 333.7、FourCastNet: 462.5）

## 背景と動機

### 数値気象予測（NWP）の課題

従来の NWP 手法は以下の問題を抱えている：

1. **計算コスト**: 10 日間予報に数百ノードのスーパーコンピュータで数時間を要する
2. **パラメータ化誤差**: 未解決プロセスを捕捉するための近似関数が誤差の原因となる
3. **並列化の困難**: 効率的な並列計算が難しい

### AI 手法の可能性と限界

深層学習による気象予測は計算速度で大きな優位性を持つが、精度面での課題があった：

- FourCastNet は 100 メンバー 24 時間予報を 7 秒で計算できるが、精度は NWP に及ばなかった
- 5 日間 Z500 予測で FourCastNet の RMSE は 484.5 と operational IFS の 333.7 に大きく劣っていた

## Pangu-Weather の技術的貢献

### 1. 3D Earth-specific Transformer (3DEST)アーキテクチャ

#### アーキテクチャ設計

高度情報を新しい次元として統合し、入力と出力を 3 次元として概念化：

- **入力構造**:
  - 上層大気変数: 13 気圧レベル × 1,440 × 721 × 5 変数
  - 地表変数: 1,440 × 721 × 4 変数
  - 空間解像度: 0.25° × 0.25°

#### 主要コンポーネント

**パッチ埋め込み (Patch Embedding)**:

- 上層大気: 2×4×4 のパッチサイズで 7×360×181×C に削減
- 地表変数: 4×4 のパッチサイズで 360×181×C に削減
- 基本チャンネル幅 C = 192

**エンコーダ・デコーダアーキテクチャ**:

- エンコーダ: 8 層（最初 2 層: 8×360×181×C、次 6 層: 8×180×91×2C）
- デコーダ: 8 層（対称構造）
- Swin Transformer に基づく設計
- 合計約 6400 万パラメータ

**Earth-specific 位置バイアス**:
従来の相対位置バイアスではなく、地球固有の絶対位置を考慮：

- 地球の球面投影による隣接トークン間の不均一な間隔を考慮
- 気圧レベル、経度、緯度の絶対座標に基づくバイアス
- パラメータ数は標準 Swin の 527 倍だが、計算コストは同じ

#### 3D モデルの優位性

高度を独立した次元として扱うことで：

- 異なる気圧レベル間の大気状態の関係を捕捉
- 2 次元モデル（FourCastNet など）と比較して大幅な精度向上

### 2. 階層的時間集約戦略

#### 動機

中期予報（7 日以上）では累積予測誤差が問題となる。反復回数を減らすことで誤差を軽減。

#### 実装

4 つの異なるリードタイム（予測間隔）のモデルを訓練：

- FM1: 1 時間予測モデル
- FM3: 3 時間予測モデル
- FM6: 6 時間予測モデル
- FM24: 24 時間予測モデル

#### 貪欲アルゴリズム

最大のリードタイムを持つモデルを優先的に使用：

- 例: 56 時間予測の場合
  - FM24 を 2 回実行（48 時間）
  - FM6 を 1 回実行（54 時間）
  - FM1 を 2 回実行（56 時間）
- FourCastNet（固定 6 時間モデル）より高速かつ高精度

### 3. 訓練戦略

#### データ

- **訓練データ**: ERA5（1979-2017 年、39 年分）
- **検証データ**: 2019 年
- **テストデータ**: 2018 年
- **総訓練サンプル数**: 341,880 時点（1 エポックあたり）

#### 訓練設定

- **最適化**: Adam オプティマイザ、100 エポック
- **損失関数**: 平均絶対誤差（MAE）
- **バッチサイズ**: 192（GPU 当たり 1 サンプル）
- **学習率**: 0.0005 から 0 へコサインスケジュールで減衰
- **計算資源**: 192 台の NVIDIA Tesla-V100 GPU
- **訓練時間**: 各モデル約 16 日

#### 正規化と重み付け

- 各 2 次元フィールドを個別に正規化（平均減算、標準偏差除算）
- 変数ごとに異なる重み（早期実行での平均損失値の逆数）
  - 上層大気: Z(3.00), Q(0.60), T(1.50), U(0.77), V(0.54)
  - 地表: MSLP(1.50), U10(0.77), V10(0.66), T2M(1.50)

## 実験結果

### 1. 決定論的グローバル気象予測

#### 全体的な性能

2018 年の ERA5 データに対する評価で、Pangu-Weather は以下を達成：

- **全テスト変数で RMSE 最小・ACC 最大**
- **全リードタイム（1 時間～ 168 時間）で優位性**
- **変数によっては 5 日以上の予測でさらに優位性が拡大**

#### 予測時間利得（Forecast Time Gain）

同じ精度到達に必要なリードタイムの差：

- operational IFS に対して: 平均 10-15 時間
- 比湿など一部変数: 24 時間以上の利得
- FourCastNet に対して: 最大 40 時間の利得

#### 地域別・変数別の詳細結果

**Z500（500hPa ジオポテンシャル）**:

- 全球: Pangu-Weather 最も低い RMSE、最も高い ACC
- 北半球、南半球、熱帯全てで優位
- リードタイムが長いほど優位性が顕著

**T850（850hPa 気温）**:

- 同様に全地域で優位性を維持

**Q500（500hPa 比湿）**:

- NWP 手法が苦手とする変数
- Pangu-Weather は訓練データから効果的なパターンを学習

**地表変数（T2M, U10, V10）**:

- 2m 気温、10m 風速成分でも一貫した優位性

### 2. 熱帯低気圧追跡

#### 追跡アルゴリズム

平均海面気圧（MSLP）の局所最小値を探索し、以下の条件を満たすものを台風の目として特定：

1. 278km 半径内に最大 850hPa 相対渦度（北半球: >5×10⁻⁵、南半球: <-5×10⁻⁵）
2. 温帯低気圧の場合、278km 半径内に 850-200hPa 間の最大厚さ
3. 陸上の場合、278km 半径内に最大 10m 風速 >8 m/s

#### 性能評価

2018 年の 88 個の名前付き熱帯低気圧に対して：

- **3 日平均直接位置誤差**:
  - Pangu-Weather: 120.29 km
  - ECMWF-HRES: 162.28 km
- **5 日平均直接位置誤差**:
  - Pangu-Weather: 195.65 km
  - ECMWF-HRES: 272.10 km
- リードタイムが長いほど優位性が拡大

#### 注目すべき事例

**台風 Kong-rey（2018-25）**:

- 2018 年世界最強クラスの熱帯低気圧の 1 つ
- ECMWF-HRES は中国上陸を予測したが、実際には上陸せず
- Pangu-Weather は正確な経路を予測
- ECMWF-HRES は 48 時間以上遅れて正しい結論に到達

**台風 Yutu（2018-26）**:

- 2018 年世界最強クラス、マリアナ諸島とフィリピンに壊滅的被害
- Pangu-Weather は上陸 6 日前に正確な経路（フィリピン方向）を予測
- ECMWF-HRES は初期段階で北東への大きな転向を誤予測
- ECMWF-HRES は 48 時間以上遅れて正しい予測に修正

**ハリケーン Michael（2018-13）**:

- 2018 年大西洋ハリケーンシーズン最強
- 上陸 3 日前の予測で両者ともフロリダ上陸を予測
- 上陸時刻の遅れ: Pangu-Weather 3 時間、ECMWF-HRES 18 時間
- 上陸後の追跡で Pangu-Weather が大幅に優位

**台風 Ma-on（2022-09）**:

- フィリピンと中国に影響を与えた強い熱帯暴風
- 上陸約 3 日前の予測で ECMWF-HRES は珠海上陸を誤予測
- Pangu-Weather の予測は実際に近い結果

#### 公平性に関する注記

ECMWF-HRES は IFS 初期条件データを使用、Pangu-Weather は再解析データを使用しており、直接比較はやや不公平である点に注意。

### 3. アンサンブル予測

#### 手法

初期気象状態に摂動を加える：

- 99 個のランダム摂動を生成（Perlin ノイズを使用）
- 3 オクターブ（スケール: 0.2, 0.1, 0.05）
- 周期数: 12, 24, 48
- 合計 100 メンバーのアンサンブル予測

#### 結果

**RMSE（Root Mean Square Error）**:

- 短期予測（1 日）: 単一モデルよりわずかに悪化
- 中長期予測（5-7 日）: 単一モデルより大幅に改善
- 非平滑変数（Q500, U10 など）で特に効果的

**CRPS（Continuous Ranked Probability Score）**:

- アンサンブル平均の精度を示す指標
- リードタイムが長いほど改善効果が大きい

**スプレッド・スキル比（Spread-Skill Ratio）**:

- 1.0 未満（やや過小分散）
- 理想的には 1.0 に近いことが望ましい
- 改善の余地あり

#### 計算効率

NWP 手法と比較してアンサンブル予測のコストを大幅に削減：

- 気象学者が専門知識を活用してノイズを制御し、精度向上が可能
- 大規模メンバーアンサンブルが実用的に

## 視覚化と解釈

### 予測結果の特徴

3 日予測の視覚化（Z500, T850, T2M, 10m 風速）から観察される特徴：

**Pangu-Weather の傾向**:

- より滑らかな等高線
- 隣接領域に類似値を予測する傾向
- 回帰アルゴリズムが平均値に収束する一般的な性質

**operational IFS の傾向**:

- 滑らかさが低い
- 各グリッドセルで初期条件から PDE を解くため
- 気象のカオス性と初期条件の不確実性により統計的不確実性が生じる

### 極値の扱い

**相対分位誤差（RQE）分析**:

- Pangu-Weather と operational IFS は共に極値を過小評価する傾向
- Pangu-Weather はリードタイムが長いほど過小評価が顕著
- AI 手法の平滑化傾向による
- ただし、熱帯低気圧追跡では個々の極端現象を正確に捕捉

## 技術的詳細

### 数学的定式化

#### 問題設定

時刻 t の全グローバル気象変数を**A**ₜ とする（サイズ: Nₗₒₙ × Nₗₐₜ × 69）:

- Nₗₒₙ = 1,440（経度方向）
- Nₗₐₜ = 721（緯度方向）
- 69 = 研究対象変数数

予測タスク: 時刻 t₀ において**A**ₜ₀ が与えられたとき、**A**ₜ₀₊Δₜ を予測

- Δt: リードタイム

深層ニューラルネットワーク: f(**A**ₜ₀; θ)

- θ: 学習可能パラメータ

#### 評価指標

**RMSE（Root Mean Square Error）**:

```
RMSE(v,Δt) = √[Σᵢ Σⱼ L(φᵢ) × (Âᵢ,ⱼ,ₜᵥ - Aᵢ,ⱼ,ₜᵥ)² / (Nₗₐₜ × Nₗₒₙ)]
```

- L(φᵢ): 緯度 φᵢ での重み = cos(φᵢ) / Σcos(φᵢ')

**ACC（Anomaly Correlation Coefficient）**:

```
ACC(v,Δt) = Σᵢ Σⱼ L(φᵢ) × A'ᵢ,ⱼ,ₜᵥ × Â'ᵢ,ⱼ,ₜᵥ / √[Σᵢ Σⱼ L(φᵢ) × (A'ᵢ,ⱼ,ₜᵥ)² × Σᵢ Σⱼ L(φᵢ) × (Â'ᵢ,ⱼ,ₜᵥ)²]
```

- A': 気候値（39 年間の長期平均）との差

### データ準備

#### ERA5 データセット

- 過去 60 年間のグローバル、時間ごとの再解析データ
- 観測データと数値モデル予測を数値同化手法で融合
- 最高空間解像度: 0.25° × 0.25°

#### 選択変数

**気圧レベル**: 13 レベル（50, 100, 150, 200, 250, 300, 400, 500, 600, 700, 850, 925, 1000 hPa）

**上層大気変数**（5 変数）:

1. ジオポテンシャル（Z）
2. 比湿（Q）
3. 気温（T）
4. 風速 u 成分（U）
5. 風速 v 成分（V）

**地表変数**（4 変数）:

1. 2m 気温（T2M）
2. 10m 風速 u 成分（U10）
3. 10m 風速 v 成分（V10）
4. 平均海面気圧（MSLP）

**定数マスク**（地表変数入力に追加）:

- 地形マスク
- 陸海マスク
- 土壌タイプマスク

### 推論速度

#### システムレベル比較

- **FourCastNet**: Tesla-A100 GPU（312 TFLOPS）で 24 時間予測に 0.28 秒
- **Pangu-Weather**: Tesla-V100 GPU（120 TFLOPS）で 24 時間予測に 1.4 秒
- GPU 性能を考慮すると、Pangu-Weather は FourCastNet より約 50%遅い

#### NWP との比較

- **operational IFS**: 数百ノードのスーパーコンピュータで数時間
- **Pangu-Weather**: 単一 GPU で 1.4 秒
- **速度比**: 10,000 倍以上高速

## 限界と課題

### 1. データソースの違い

- **訓練・テスト**: 再解析データ（ERA5）を使用
- **実運用**: 観測データを使用
- データソース間の違いによる性能への影響は要調査

### 2. 未検討の気象変数

- **降水量**: 本研究では検討されていない
- 小規模な極端気象現象（竜巻発生など）の予測に影響の可能性

### 3. 平滑化傾向

- AI 手法は平滑な予測結果を生成
- 極端気象の強度を過小評価するリスク
- 熱帯低気圧追跡は検討したが、更なる研究が必要

### 4. 時間的不整合性

- 異なるリードタイムのモデル使用による時間的不整合の可能性
- さらなる調査が必要な困難なトピック

## 将来の展望

### AI 側の改善方向

1. **より多くの垂直レベルと大気変数の組み込み**
2. **時間次元の統合と 4 次元深層ネットワークの訓練**
3. **より深い/広いネットワーク**
4. **訓練エポック数の増加**

全ての方向は、より大きなメモリと FLOPS を持つ強力な GPU クラスタを必要とする。

### NWP 側の改善方向

- 予測可能なバイアスを軽減する後処理手法の開発

### 統合の可能性

AI 手法と NWP 手法の組み合わせにより、さらに強力な性能をもたらすことが期待される。

## 「盤古（Pangu）」の名称について

盤古は中国神話における原初の存在であり創造神話の人物。天と地を分離し、山や川などの地理的特徴となった。この名称は、Huawei Cloud が開発した事前訓練 AI モデルシリーズの一部であり、コンピュータビジョン、自然言語処理、マルチモーダル理解、科学計算（気象予測を含む）などをカバーしている。

## データとコードの利用可能性

### データソース

- **ERA5 データセット**: https://cds.climate.copernicus.eu/（約60TB）
- **ECMWF 予測データ**: https://confluence.ecmwf.int/display/TIGGE
- **IBTrACS**: https://www.ncei.noaa.gov/products/international-best-track-archive

### コード

- **ベースフレームワーク**: PyTorch
- **参照実装**: Swin Transformer (https://github.com/microsoft/Swin-Transformer)
- **公開リポジトリ**: https://github.com/198808xc/Pangu-Weather
- **DOI**: https://doi.org/10.5281/zenodo.7678849
- **追加ライブラリ**: xskillscore (CRPS 計算), perlin-numpy (Perlin ノイズ), NumPy, Matplotlib

### 提供内容

1. 訓練済みモデル
2. 推論コード
3. 詳細な擬似コード
4. ERA5 初期場と ECMWF 初期場の両方に対応（後者は準リアルタイム気象予測 API として使用可能）

## 結論

Pangu-Weather は、深層学習を用いた高速かつ高精度な気象予測システムであり、以下の点で画期的な成果を達成した：

1. **精度**: 再解析データに対する決定論的予測で世界最高の NWP システムを上回る
2. **速度**: 10,000 倍以上の高速化を実現
3. **汎用性**: 極端気象予測やアンサンブル予測でも優れた性能
4. **技術革新**: 3DEST アーキテクチャと階層的時間集約戦略

本研究は、大規模事前訓練モデルの様々な下流アプリケーションへの適用可能性を示し、コンピュータビジョン、自然言語処理、クロスモーダル理解などの他の AI 分野と同じトレンドを示している。

ただし、実用化に向けては、観測データでの性能評価、降水量などの追加変数の組み込み、極値予測の改善、時間的整合性の確保など、いくつかの課題が残されている。今後、AI 手法と NWP 手法の融合により、さらなる性能向上が期待される。
