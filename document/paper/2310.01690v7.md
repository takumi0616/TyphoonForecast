# Forecasting Tropical Cyclones with Cascaded Diffusion Models
## カスケード型拡散モデルによる熱帯低気圧予測

**著者:**
- Pritthijit Nath (Imperial College London, Department of Computing)
- Pancham Shukla (Imperial College London, Department of Computing)
- Shuai Wang (University of Delaware, Department of Geography and Spatial Sciences)
- César Quilodrán-Casas (Imperial College London, Department of Earth Science and Engineering)

**出典:** Published as a workshop paper at "Tackling Climate Change with Machine Learning", ICLR 2024
**arXiv:** 2310.01690v7 [physics.ao-ph] 30 Jul 2024
**コード:** https://github.com/nathzi1505/forecast-diffmodels

---

## 概要（Abstract）

気候変動により熱帯低気圧がより激しくなる中、AIベースのモデリングの台頭は、数学モデルに基づく従来の手法と比較して、より手頃で利用しやすいアプローチを提供します。本研究は、衛星画像、リモートセンシング、大気データを統合することにより、サイクロンの軌道と降水パターンを予測するために生成拡散モデルを活用しています。

本研究は、予測、超解像度、降水モデリングという3つの主要なタスクを組み込んだカスケードアプローチを採用しています。訓練データセットには、2019年1月から2023年3月までの6つの主要な熱帯低気圧海域からの51のサイクロンが含まれています。

実験により、カスケードモデルからの最終予測が、36時間のロールアウトまで正確な予測を示し、3つのタスクすべてで優れた構造類似性（SSIM）とピーク信号対雑音比（PSNR）値（それぞれ0.5および20 dBを超える）を示すことが実証されました。36時間予測は、単一のNvidia A30/RTX 2080 Tiで30分という短時間で生成できます。

本研究はまた、熱帯低気圧予測などの気象予測における高性能ニーズに対する拡散モデルなどのAI手法の有望な効率性を強調し、計算コストを手頃に保ちながら、重要な予測ニーズと財政的制約がある非常に脆弱な地域に理想的なものとなっています。

---

## 1. 序論（Introduction）

気候変動は、地球の気候システムに前例のない変化をもたらし、その結果、降水パターンの変化と壊滅的な環境影響を伴う極端な降雨イベントの急増を引き起こしている、差し迫った地球規模の問題です[1]。地球温暖化と変化する大気循環パターンは、これらの極端なイベントの重要な推進力であり[2]、水資源管理、インフラ計画、災害リスク軽減に課題をもたらしています[3]。

高度な機械学習（ML）技術は、気候変動下での極端な降雨の挙動を予測し理解するための有望な解決策として浮上してきました[4]。これらのアルゴリズムは、大規模なデータセットを分析し、複雑な時空間関係を捉え、明示的なプログラミングを必要とせずに正確な予測を行うことができます。GPUや分散アーキテクチャなどの最新のコンピューティングシステムを活用することで、MLは気象モデリングへの革命的なアプローチを提供し、従来のスーパーコンピューターベースのシミュレーションを置き換えます[5]。

### 拡散モデルの応用

近年、拡散モデル[6]は、気象予測、気候モデリング、画像処理を含む様々な分野で大きな注目を集めています：

- **Leinonen et al. [7]**: 降水ナウキャスティングのための潜在拡散モデル（LDM）を導入し、従来の手法や深層生成モデルを精度と不確実性定量化で上回りました

- **Bassetti et al. [8]**: 拡散モデル、特にDiffESMの効率性を実証し、より少ない計算リソースで極端な気象イベントを分析するために地球システムモデル（ESM）をエミュレートしました

- **Hatanaka et al. [9]**: スコアベースの拡散モデルを使用して気象と気候予測における不確実性モデリングを改善し、高次元太陽放射照度予測に利益をもたらしました

- **Addison et al. [10]**: 拡散モデルが洪水モデリングのために低解像度シミュレーションから現実的な高解像度降雨サンプルを生成する能力を示しました

### 本研究の貢献

本研究は、拡散モデルを利用した大気モデリングにおける以前の研究から着想を得ています。複数の拡散モデルをカスケード方式で組織化して熱帯低気圧（TC）を予測する新しいアプローチを探求しています。熱帯低気圧は、気候変動によって激化した極端な降雨イベントの重要な例です。

特に、本研究は以下の方法でAIベースの大気モデリングに関する既存の文献に貢献します：

1. **新しいフレームワークの適応**: 自然言語処理（NLP）タスク（テキストから画像への生成、画像から画像への変換など）でよく使用される拡散モデルを利用したフレームワークの新しい適応で、ERA5[11][12]やIR 10.8μm衛星データなどの公開されている大気再解析データを使用してTCを予測します

2. **高い予測能力の実証**: 単一ステップのSSIMとPSNRがそれぞれ0.5と20 dBを超える非常に効果的なモデル予測能力の実験的実証と、約36時間のロールアウトでの強力な精度

3. **コスト効率の高いモデル設計**: 単一GPU（例：Nvidia RTX 2080 Ti）で最適化されたモデル設計により、高価なスーパーコンピューターを利用する従来のシミュレーションベースの方法と同等の予測能力を示しながら、AIベースの手法の手頃さの議論を強調

---

## 2. データ（Data）

### 2.1 データ取得

#### 1. 衛星データ

2019年1月から2023年3月の期間にわたり、6つの主要な海域から、サフィア・シンプソン・ハリケーン風速スケール[13]で2以上で、主要な上陸影響があると報告された合計51のサイクロンの赤外線（IR）10.8μmデータを抽出しました。

**表1: 衛星データプロバイダーとサイクロン数を含むTC海域のリスト**

| 半球 | 海域 | 衛星 | サブ地域 | カウント |
|------|------|------|----------|----------|
| 北半球 | 北インド洋 | INSAT-3D | 南アジア | 13 |
| | 北大西洋 | GOES-East | 米国東海岸 | 11 |
| | 東太平洋 | GOES-East/West | 米国西海岸 | 4 |
| | 西太平洋 | Himawari 8/9 | フィリピン | 9 |
| 南半球 | 南西インド洋 | Meteosat-9 | マダガスカル | 8 |
| | オーストラリア | Himawari 8/9 | 北オーストラリア | 6 |

#### 2. 大気データ

各記録されたサイクロンについて、形成から消滅までの期間にわたり、表A.1に示す4つの大気変数の時間ごとのERA5再解析データをCopernicus Climate Data Storeから取得しました。

### 2.2 データ処理

#### 1. バウンディングボックスの定式化

すべての51のサイクロンに対して、ハリケーンの形成から消滅までの全軌跡にわたってすべての関心領域をカバーするために、正方形のバウンディングボックスが経験的に決定されました。これらのバウンディングボックスは、フルディスクIR 10.8μm衛星画像と対応するERA5データをトリミングして、サイクロンデータセットを生成するために使用されました。

#### 2. メタデータの作成

メモリから特定のサイクロンを容易に取得し、パスアクセシビリティの問題に対処するために、すべての必要なメタデータを含む機能的なデータ構造が設計されました。含まれるフィールドは以下の通り：
- 地域
- 名前
- バウンディングボックス座標
- ERA5ファイル名
- 総ファイル数
- 各衛星ファイルの日付、ファイルパス、対応するERA5インデックスなどのデータフィールドを含むサブデータ構造のリスト

#### 3. トレーニング・テスト分割

使用される拡散モデルの公平な評価のために、サイクロンデータセット全体の20％（地域ごとに計算）がテストセット評価用に予約され、データセットの残りの80％がトレーニング目的に使用されました。

#### 4. データローダーの生成

タスク固有のデータローダーがメタデータ構造上に作成され、モデルトレーニングを促進し、データロードプロセスを合理化しました：

- 生の衛星とERA5画像データは、64x64（予測と降水モデリング）および128x128（超解像度）にダウンサイズ
- 指定されたバッチサイズのランダムにサンプリングされたバッチに分割
- min-max正規化やrotate90などのデータ拡張などの補助的な方法がデータローダーレベルで導入され、モデルトレーニングを支援

---

## 3. 方法論（Methodology）

### 3.1 カスケード構造

Imagenペーパー[14]とテキスト入力を条件とした画像生成への応用[15]から着想を得て、本研究は図1に示すカスケード配置を採用しています。

**図1: 3つのタスク固有の拡散モデルを含むカスケード配置の図解**

この特定の配置は、3つの独立して訓練されたU-Netベースの拡散モデルを利用し、各モデルは特定のタスクに合わせて調整され、最終的にサイクロン予測生成の効率を向上させます：

1. **予測タスク**: 時刻tの64x64衛星IR 10.8μmを使用して、時刻t+1での予測を生成
2. **超解像度タスク**: 生成された64x64予測の128x128衛星10.8μmバージョンを作成
3. **降水モデリングタスク**: 予測に対応する64x64総降水マップを生成

3つのタスクすべてで、時刻t+1で予測されたERA5データが入力を条件付けるために使用されます。

### モデルアーキテクチャ

各拡散モデルについて、Imagen[15]と類似のU-Net構造が使用され、以下の追加の改良が含まれています：

- **分類器フリーガイダンス**[16]
- **動的しきい値処理**: 正規化範囲内に出力を維持するため
- **指数移動平均された重み**

データ拡張技術には、4つのすべての方向をカバーするrotate90と低解像度ノイズ注入（超解像度タスク用）も使用され、モデル出力の改善に貢献することがわかりました。総降水マップのノイズを除去するために、後処理として最小フィルターも利用されています。

### 3.2 評価戦略

本研究で言及された3つのカスケード拡散モデルを効果的に評価するために、2つの評価戦略が実施されました：

1. **定量的メトリクス**: すべてのエポックにわたる1ステップのパフォーマンスを評価するために、MAE、PSNR、SSIM、FIDスコアを含む定量的メトリクスを使用

2. **ロールアウト分析**: 初期IR 10.8μmから開始し、予測されたERA5データの支援を受けて自己回帰的に生成された予測に対して、サイクロン全期間にわたるSSIM評価を使用したロールアウト分析を実行

---

## 4. 結果（Results）

### パフォーマンス評価

表2は、4つの異なるメトリクスにわたる最良のパフォーマンスモデルチェックポイントのパフォーマンス評価を示しています。

**表2: テストセット全体でのタスク別パフォーマンスメトリクス**

| タスク | ベストエポック | MAE↓ | PSNR↑ | SSIM↑ | FID↓ |
|--------|--------------|------|-------|-------|------|
| 予測 | 180 | 0.200 | 24.359 | 0.572 | 0.168 |
| 超解像度 | 240 | 0.186 | 25.760 | 0.658 | 0.214 |
| 降水モデリング | 260 | 0.134 | 25.943 | 0.643 | 0.907 |

### 主な結果

これらの結果は、予測目的での3つすべての拡散モデルの顕著な予測能力を強調しています：

- **PSNR**: すべてのモデルで一貫して20dBのしきい値を超える
- **SSIM**: すべてのモデルで一貫して0.5のしきい値を超える
- **MAE**: 正規化された画像で測定され、一貫して0.25未満の値
- **FIDスコア**: すべての3つのモデルで1未満

### ロールアウト分析

表1の地域別テストセットに属するすべてのサイクロンの予測（図2に示すサイクロンMochaなど）について、図B.1に表示されたサイクロン全期間にわたって生成されたSSIMチャートを詳しく調べると、ほとんどのサイクロン予測で約36時間のマークで顕著な低下が観察されます。

**図2: 2023年5月10日の北インド洋上のサイクロンMochaの31時間（左）と38時間（右）の予測**
- 上段：グラウンドトゥルースIR 10.8μm衛星画像と総降水量
- 下段：その特定のタイムステップで生成された予測

絶対的なロールアウトを確実性を持って特定することの課題を考慮すると、約36時間のマーク（Nvidia A30/RTX 2080Tiで約30分）での一貫した急激な「ディップ」の発生は、そのような時間長さが、生成された予測が実際の状態と密接に一致すると推定できる信頼できる地平線と見なすことができることを示唆しています。

### 計算効率

- **予測生成時間**: 単一のNvidia A30/RTX 2080 Tiで約30分
- **予測地平線**: 約36時間まで高精度を維持

---

## 5. 結論（Conclusion）

本研究は、カスタム構築されたデータ処理パイプラインによってサポートされ、ERA5大気再解析データに加えてIR 10.8μmで訓練された、熱帯低気圧を予測するための新しいカスケード型拡散モデルアーキテクチャを提示しています。

### 主要な成果

1. **高精度予測**: 約36時間の地平線を持つ予測のための十分に強力な能力
2. **計算効率**: ERA5などの大気データと統合された場合、単一GPUに最適化されたこれらのコスト効率の高いAIベースのモデリングのインスタンスは、手頃で、ほぼリアルタイムで、正確で、写実的な予測を促進
3. **脆弱な地域への適用**: 重要な予測需要があるが財政的に制約されている非常に脆弱な地域に特に適している

### 今後の方向性

本研究の将来の反復は以下を目指しています：

1. **長期間のモデリング**: より長い期間（例：10年）にわたるサイクロンのモデリングを探求
2. **より広範な大気データ**: より広範な大気データ変数の配列を組み込む
3. **ERA5予測の機械学習**の最近の発展[17][18]と、マルチGPU Nvidia A100セットアップを含むより強力な計算プラットフォームの使用を活用
4. **モデルの予測精度と効率の向上**: 限られた実行時間枠での向上

---

## 付録A: 追加データ説明

### A.1 ERA5変数

**表A.1: 条件データとして考慮されたERA5変数のリスト**

| 名前 | 単位 |
|------|------|
| 10m u成分の風 | m/s |
| 10m v成分の風 | m/s |
| 総雲量 | - |
| 総降水量 | m |

実施された実験では、サイクロンの歴史的性質により、予測されたERA5は、ECWMFによって生成されたERA5再解析データを指します。展開シナリオでは、ERA5が5日の遅延を持つため、予測システムからの実際の予測大気データ（3つの変数に対応）を使用できます。したがって、Global Forecast System（GFS）などの一般的な予測システムとの一貫性を確保するために、これらの特定の4つの変数が選択されています。

---

## 付録B: 追加結果

### B.1 予測SSIM

サイクロン全期間にわたるSSIM値を以下に示します。破線は、各サイクロンで最小SSIM値が得られる時間マークを示しています：

1. **Mocha（北インド洋）**
2. **Ida（北大西洋）**
3. **Rosyln（東太平洋）**
4. **Molave（西太平洋）**
5. **Gombe（南西インド洋）**
6. **Veronica（オーストラリア）**

---

## 参考文献（References）

[1] IPCC. Climate Change 2021: The Physical Science Basis.
[2] Donat et al. More extreme precipitation in the world's dry and wet regions. Nature Climate Change, 2016.
[3] Van Aalst. The impacts of climate change on the risk of natural disasters. Disasters, 2006.
[4] Pouyanfar et al. A Survey on Deep Learning: Algorithms, Techniques, and Applications. ACM Computing Surveys, 2018.
[5] Schalkwijk et al. Weather Forecasting Using GPU-Based Large-Eddy Simulations. Bulletin of the American Meteorological Society, 2015.
[6] Ho et al. Denoising Diffusion Probabilistic Models. arXiv, 2020.
[7] Leinonen et al. Latent diffusion models for generative precipitation nowcasting with accurate uncertainty quantification. arXiv, 2023.
[8] Bassetti et al. DiffESM: Conditional Emulation of Earth System Models with Diffusion Models. arXiv, 2023.
[9] Hatanaka et al. Diffusion Models for High-Resolution Solar Forecasts. arXiv, 2023.
[10] Addison et al. Machine learning emulation of a local-scale UK climate model. arXiv, 2022.
[11] Hersbach et al. The ERA5 global reanalysis. Quarterly Journal of the Royal Meteorological Society, 2020.
[12] Lavers et al. An evaluation of ERA5 precipitation for climate monitoring. Quarterly Journal of the Royal Meteorological Society, 2022.
[13] Oxford University Press. A Dictionary of Earth Sciences, 2008.
[14] Ho et al. Cascaded Diffusion Models for High Fidelity Image Generation. Journal of Machine Learning Research, 2022.
[15] Wang. Implementation of Imagen, Google's Text-to-Image Neural Network, in Pytorch. GitHub, 2023.
[16] Ho & Salimans. Classifier-Free Diffusion Guidance. arXiv, 2022.
[17] Scholz et al. Sim2Real for Environmental Neural Processes. arXiv, 2023.
[18] Bonev et al. Spherical Fourier Neural Operators: Learning Stable Dynamics on the Sphere. arXiv, 2023.

---

## まとめ

本論文は、カスケード型拡散モデルを使用した熱帯低気圧予測の新しいアプローチを提示しています。主な利点は以下の通りです：

1. **高い予測精度**: 36時間の予測地平線で優れたパフォーマンス
2. **計算効率**: 単一GPUで30分以内に予測を生成
3. **コスト効率**: 高価なスーパーコンピューターなしで運用可能
4. **実用性**: 財政的制約がある脆弱な地域に理想的

この研究は、AIベースの気象予測手法が従来のシミュレーションベースのアプローチの有望な代替手段となり得ることを示しています。
